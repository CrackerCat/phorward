#!/bin/sh
#-------------------------------------------------------------------------------
# Phorward Foundation Toolkit
# Copyright (C) 2006-2015 by Phorward Software Technologies, Jan Max Meyer
# http://www.phorward-software.com ++ contact<at>phorward<dash>software<dot>com
# All rights reserved. See LICENSE for more information.
#
# Script:		pinclude
# Author:		Jan Max Meyer
# Usage:		Local include resolver
#-------------------------------------------------------------------------------

if [ $# -lt 1 ]
then
	echo "usage: $0 <filenames>"
	exit 1
fi

echo "/*"
echo "	This file was automatically generated by `basename $0`."
echo "	DO NOT CHANGE THIS FILE MANUALLY. IT WILL GO AWAY!"
echo "*/"

while [ "$1" != "" ]
do
	awk '

BEGIN				{	FS = "[ \t\"]+"		}

/##include[ \t]+\"/	{
						if( !system( "test -f " $2 ) )
						{
							print "/* BEGIN $2 */"
							system( "cat " $2 )
							print "/* END $2 */"
						}
						else
						{
							print "pinclude: File not found: " $2
							exit 1
						}
						next
					}

/##call/			{
						gsub( /##call/, "" )
						print "/* BEGIN " $0 " */"
						system( $0 )
						print "/* END " $0 " */"
						next
					}

					{
						print
					}
	' $1 | premcomments

	if [ $? -ne 0 ]
	then
		exit 1
	fi

	shift
done

